<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Anomaly Detector - Industrial Vision System</title>

	<!-- Self-hosted Material Icons (requires font download) -->
	<link rel="stylesheet" href="/css/material-icons.css">

	<!-- Self-hosted styles -->
	<link rel="stylesheet" href="/css/style.css">
</head>

<body>

	<!-- Header -->
	<header class="header">
		<div class="container">
			<div class="header-content">
				<div>
					<h1 class="header-title">
						<span class="icon">search</span>
						Anomaly Detector
					</h1>
					<p class="header-subtitle">Industrial Vision System Configuration</p>
				</div>
				<div class="header-status">
					<div class="status-label">System Status</div>
					<div class="status-value" id="headerStatus">
						<span class="status-dot status-dot-red"></span>
						<span id="headerStatusText">Stopped</span>
					</div>
				</div>
			</div>
		</div>
	</header>

	<!-- Main Container -->
	<div class="container main-content">

		<!-- Alert Box -->
		<div id="alertBox"></div>

		<!-- Tab Navigation -->
		<div class="tab-navigation">
			<button class="tab-button active" onclick="switchTab('detection')">
				<span class="icon">analytics</span>
				Detection
			</button>
			<button class="tab-button" onclick="switchTab('datacollection')">
				<span class="icon">photo_library</span>
				Data Collection
			</button>
		</div>

		<!-- Detection Tab -->
		<div id="detectionTab" class="tab-content active">

			<!-- Status Cards -->
			<div class="status-cards">
				<div class="card">
					<div class="card-label">TorchServe Status</div>
					<div class="card-value" id="torchserveStatus">
						<span class="icon icon-loading rotating">sync</span>
						<span class="text-muted">Checking...</span>
					</div>
				</div>

				<div class="card">
					<div class="card-label">Configuration</div>
					<div class="card-value" id="configStatus">
						<span class="icon icon-error">close</span>
						<span>Not Set</span>
					</div>
				</div>

				<div class="card">
					<div class="card-label">Camera</div>
					<div class="card-value" id="cameraStatus">
						<span class="icon icon-loading rotating">sync</span>
						<span class="text-muted">Checking...</span>
					</div>
				</div>
			</div>

			<!-- Step 1: Configure Settings -->
			<div class="step" id="step1">
				<div class="step-header">
					<div class="step-number">1</div>
					<h2 class="step-title">Configure Detection Settings</h2>
				</div>

				<div class="form-grid">
					<div class="form-group">
						<label class="form-label">
							<span class="icon icon-small">videocam</span>
							Camera Resolution
						</label>
						<select id="resolution" class="form-input">
							<option value="640x480">640 × 480 (VGA)</option>
							<option value="1280x720" selected>1280 × 720 (HD)</option>
							<option value="1920x1080">1920 × 1080 (Full HD)</option>
						</select>
					</div>

					<div class="form-group">
						<label class="form-label">
							<span class="icon icon-small">speed</span>
							Frame Rate (FPS)
						</label>
						<input type="number" id="fps" value="10" min="1" max="30" class="form-input">
					</div>

					<div class="form-group">
						<label class="form-label">
							<span class="icon icon-small">tune</span>
							Detection Threshold (0.0 - 1.0)
						</label>
						<input type="number" id="threshold" value="0.5" min="0" max="1" step="0.05" class="form-input">
					</div>

					<div class="form-group">
						<label class="form-label">
							<span class="icon icon-small">visibility</span>
							Show Anomaly Overlay
						</label>
						<div class="toggle-container">
							<label class="toggle-switch">
								<input type="checkbox" id="includeOverlay">
								<span class="toggle-slider"></span>
							</label>
							<span class="toggle-label" id="overlayLabel">Disabled</span>
						</div>
						<p class="form-hint">Display heatmap and segmentation mask visualization</p>
					</div>
				</div>

				<div class="form-grid">
					<div class="form-group">
						<label class="form-label">
							<span class="icon icon-small">email</span>
							Alert Email (optional)
						</label>
						<input type="text" id="alertEmail" placeholder="operator@company.com" class="form-input">
					</div>
				</div>

				<button onclick="saveConfig()" class="btn btn-primary">
					<span class="icon">save</span>
					Save Configuration
				</button>
			</div>

			<!-- Step 2: Upload Test Image -->
			<div class="step" id="step2">
				<div class="step-header">
					<div class="step-number">2</div>
					<h2 class="step-title">Test Anomaly Detection</h2>
				</div>

				<p class="step-description">
					Upload images to test anomaly detection using the configured threshold.
				</p>

				<!-- Upload or Capture Test Image -->
				<div class="upload-section">
					<div class="upload-zone upload-zone-small" id="testImageZone">
						<span class="icon upload-icon-small">image</span>
						<p class="upload-title">Drop test image here</p>
						<p class="upload-subtitle">Supported: JPG, PNG, BMP</p>
					</div>
					<input type="file" id="testImageInput" accept="image/*" class="hidden">

					<div class="button-group mt-2">
						<button onclick="takeTestImage()" class="btn btn-secondary">
							<span class="icon">camera_alt</span>
							Take Image
						</button>
					</div>
				</div>

				<!-- Test Image & Result -->
				<div id="captureResult" class="hidden capture-result">
					<div class="capture-grid">
						<div class="capture-image-box">
							<h3 class="capture-title">Uploaded Image</h3>
							<img id="capturedImage" src="" alt="Uploaded frame" class="captured-image">
						</div>

						<div class="capture-image-box">
							<h3 class="capture-title">Model 1 - Heatmap</h3>
							<img id="capturedImageOverlay1" src="" alt="Model 1 overlay" class="captured-image">
						</div>

						<div class="capture-image-box">
							<h3 class="capture-title">Model 2 - Heatmap</h3>
							<img id="capturedImageOverlay2" src="" alt="Model 2 overlay" class="captured-image">
						</div>

						<div class="prediction-result-box">
							<h3 class="result-title">
								<span class="icon">analytics</span>
								Model 1 - Prediction Result
							</h3>
							<div class="result-grid">
								<div class="result-card">
									<div class="result-label">Anomaly Score</div>
									<div class="result-value result-value-primary" id="anomalyScore">-</div>
								</div>
								<div class="result-card">
									<div class="result-label">Classification</div>
									<div class="result-value" id="anomalyClass">-</div>
								</div>
								<div class="result-card">
									<div class="result-label">Inference Time</div>
									<div class="result-value result-value-secondary" id="inferenceTime">-</div>
								</div>
							</div>
						</div>

						<div class="prediction-result-box">
							<h3 class="result-title">
								<span class="icon">analytics</span>
								Model 2 - Prediction Result
							</h3>
							<div class="result-grid">
								<div class="result-card">
									<div class="result-label">Anomaly Score</div>
									<div class="result-value result-value-primary" id="anomalyScore2">-</div>
								</div>
								<div class="result-card">
									<div class="result-label">Classification</div>
									<div class="result-value" id="anomalyClass2">-</div>
								</div>
								<div class="result-card">
									<div class="result-label">Inference Time</div>
									<div class="result-value result-value-secondary" id="inferenceTime2">-</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>

			<!-- Step 3: Start Detection -->
			<div class="step" id="step3">
				<div class="step-header">
					<div class="step-number">3</div>
					<h2 class="step-title">Start Continuous Detection</h2>
				</div>

				<p class="step-description">
					Start monitoring the camera feed for anomalies.
				</p>

				<div class="button-group">
					<button id="startBtn" onclick="startDetector()" disabled class="btn btn-success btn-large">
						<span class="icon">play_arrow</span>
						Start Detection
					</button>
					<button id="stopBtn" onclick="stopDetector()" disabled class="btn btn-danger btn-large">
						<span class="icon">stop</span>
						Stop Detection
					</button>
				</div>
			</div>

			<!-- System Logs -->
			<div class="step">
				<div class="step-header">
					<span class="icon step-icon">terminal</span>
					<h2 class="step-title">System Logs</h2>
				</div>

				<div id="logs" class="logs">
					<div class="log-entry log-muted">Waiting for activity...</div>
				</div>
			</div>

		</div> <!-- End Detection Tab -->

		<!-- Data Collection Tab -->
		<div id="datacollectionTab" class="tab-content">

			<!-- Collection Status Card -->
			<div class="collection-status-card" id="collectionStatusCard">
				<div class="collection-status-header">
					<h3>Collection Status</h3>
					<span class="collection-badge" id="collectionBadge">No Active Collection</span>
				</div>
				<div id="collectionProgress" class="hidden">
					<div class="progress-info">
						<span id="collectedCount">0</span> / <span id="totalCount">0</span> images collected
					</div>
					<div class="progress-bar-container">
						<div class="progress-bar" id="progressBar" style="width: 0%"></div>
					</div>
					<div class="collection-details">
						<div><strong>Folder:</strong> <span id="collectionFolder">-</span></div>
						<div><strong>Next capture:</strong> <span id="nextCapture">-</span></div>
					</div>
					<div class="button-group">
						<button onclick="pauseCollection()" id="pauseBtn" class="btn btn-warning">
							<span class="icon">pause</span>
							Pause
						</button>
						<button onclick="resumeCollection()" id="resumeBtn" class="btn btn-success hidden">
							<span class="icon">play_arrow</span>
							Resume
						</button>
						<button onclick="cancelCollection()" class="btn btn-danger">
							<span class="icon">cancel</span>
							Cancel Collection
						</button>
					</div>
				</div>
			</div>

			<!-- Schedule New Collection -->
			<div class="step">
				<div class="step-header">
					<div class="step-number">1</div>
					<h2 class="step-title">Schedule Data Collection</h2>
				</div>

				<div class="form-grid">
					<div class="form-group">
						<label class="form-label">
							<span class="icon icon-small">camera</span>
							Total Number of Images
						</label>
						<input type="number" id="totalImages" value="1000" min="1" class="form-input">
					</div>

					<div class="form-group">
						<label class="form-label">
							<span class="icon icon-small">videocam</span>
							Camera Resolution
						</label>
						<select id="collectionResolution" class="form-input">
							<option value="640x480">640 × 480 (VGA)</option>
							<option value="1280x720" selected>1280 × 720 (HD)</option>
							<option value="1920x1080">1920 × 1080 (Full HD)</option>
						</select>
					</div>
				</div>

				<!-- Calendar Selection Type -->
				<div class="form-group">
					<label class="form-label">
						<span class="icon icon-small">event</span>
						Schedule Type
					</label>
					<div class="toggle-container">
						<label class="radio-option">
							<input type="radio" name="scheduleType" value="dates" checked onchange="updateScheduleType()">
							<span>Specific Dates</span>
						</label>
						<label class="radio-option">
							<input type="radio" name="scheduleType" value="weekdays" onchange="updateScheduleType()">
							<span>Days of Week</span>
						</label>
					</div>
				</div>

				<!-- Specific Dates Selection -->
				<div id="specificDatesSection" class="form-group">
					<label class="form-label">Select Dates</label>
					<div class="date-picker-container">
						<input type="date" id="dateSelector" class="form-input">
						<button onclick="addDate()" class="btn btn-secondary">
							<span class="icon">add</span>
							Add Date
						</button>
					</div>
					<div id="selectedDates" class="selected-items"></div>
				</div>

				<!-- Days of Week Selection -->
				<div id="weekdaysSection" class="form-group hidden">
					<label class="form-label">Select Days of Week</label>
					<div class="weekday-selector">
						<label class="checkbox-option">
							<input type="checkbox" value="1">
							<span>Monday</span>
						</label>
						<label class="checkbox-option">
							<input type="checkbox" value="2">
							<span>Tuesday</span>
						</label>
						<label class="checkbox-option">
							<input type="checkbox" value="3">
							<span>Wednesday</span>
						</label>
						<label class="checkbox-option">
							<input type="checkbox" value="4">
							<span>Thursday</span>
						</label>
						<label class="checkbox-option">
							<input type="checkbox" value="5">
							<span>Friday</span>
						</label>
						<label class="checkbox-option">
							<input type="checkbox" value="6">
							<span>Saturday</span>
						</label>
						<label class="checkbox-option">
							<input type="checkbox" value="0">
							<span>Sunday</span>
						</label>
					</div>
					<div class="form-group">
						<label class="form-label">Collection Period</label>
						<div class="form-grid">
							<input type="date" id="weekdayStartDate" class="form-input" placeholder="Start Date">
							<input type="date" id="weekdayEndDate" class="form-input" placeholder="End Date">
						</div>
					</div>
				</div>

				<!-- Hour Slots Selection -->
				<div class="form-group">
					<label class="form-label">
						<span class="icon icon-small">schedule</span>
						Select Hour Slots (6 AM - 6 PM)
					</label>
					<div class="hour-slots-grid" id="hourSlots">
						<!-- Will be generated by JavaScript -->
					</div>
				</div>

				<!-- Collection Summary -->
				<div class="collection-summary" id="collectionSummary">
					<h4>Collection Summary</h4>
					<div id="summaryContent">Configure collection parameters above</div>
				</div>

				<button onclick="saveCollectionSchedule()" class="btn btn-primary btn-large">
					<span class="icon">save</span>
					Start Collection
				</button>
			</div>

			<!-- Browse Collected Images -->
			<div class="step">
				<div class="step-header">
					<div class="step-number">2</div>
					<h2 class="step-title">Browse Collected Images</h2>
				</div>

				<button onclick="loadCollectionFolders()" class="btn btn-secondary">
					<span class="icon">refresh</span>
					Refresh Folders
				</button>

				<div id="collectionFolders" class="collection-folders">
					<div class="text-muted">No collection folders found</div>
				</div>
			</div>

		</div> <!-- End Data Collection Tab -->

	</div>

	<script src="/js/app.js"></script>
	<script src="/js/datacollection.js"></script>
</body>

</html>
